"use strict";(self.webpackChunkbp_13=self.webpackChunkbp_13||[]).push([[896],{1896:(J,v,a)=>{a.r(v),a.d(v,{UnitsModule:()=>F});var U=a(9808),o=a(8356),c=a(8892),d=a(3075),C=a(4448),S=a(9318),h=a(7579),D=a(9654),m=a(2722),T=a(5698),e=a(5e3),y=a(434),b=a(9665);let A=(()=>{class s{constructor(i,t,n,l){this.nbDialogRef=i,this.nbToastrService=t,this.tokenService=n,this.unitsService=l,this.unitNameStatus="basic",this.units=[],this.unsubscribe=new h.x,this.trigger=o.qkg.NOOP,this.editUnitForm=new d.cw({unitName:new d.NI({})})}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}ngOnInit(){this.unitsService.getUnits().pipe((0,m.R)(this.unsubscribe)).subscribe(t=>{var n;this.units=t,this.editUnitForm.patchValue({unitName:null===(n=t.find(l=>l.id===this.unitId))||void 0===n?void 0:n.name})});const i=this.editUnitForm.controls.unitName;i.valueChanges.pipe((0,m.R)(this.unsubscribe)).subscribe(t=>{this.units.some(n=>n.name===t)?(i.setErrors({exists:"name exists"}),this.unitNameStatus="danger",this.nbTooltip.show()):(i.setErrors(null),this.unitNameStatus="basic",this.nbTooltip.hide())})}dismiss(){document.querySelectorAll(".cdk-overlay-connected-position-bounding-box").forEach(i=>i.remove()),this.nbDialogRef.close()}onSubmit(){this.unitsService.updateUnit(this.unitId,this.editUnitForm.controls.unitName.value).pipe((0,T.q)(1),(0,m.R)(this.unsubscribe)).subscribe(i=>{i&&(this.dismiss(),this.nbToastrService.success("Jednotka \xfasp\u011b\u0161n\u011b upravena","Jednotka upravena",{duration:2e3}))},i=>{this.nbToastrService.danger(i.error.message,"Jednotka nebyla upravena")},()=>{})}}return s.\u0275fac=function(i){return new(i||s)(e.Y36(o.X4l),e.Y36(o.quB),e.Y36(y.B),e.Y36(b.X))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-edit-dialog"]],viewQuery:function(i,t){if(1&i&&e.Gf(o.jNv,5),2&i){let n;e.iGM(n=e.CRH())&&(t.nbTooltip=n.first)}},inputs:{unitId:"unitId"},decls:16,vars:4,consts:[[3,"formGroup","ngSubmit"],["accent","primary"],["icon","layers"],["fxLayoutGap","1em","fxLayout","column"],["nbPrefix","","icon","layers-outline"],["nbInput","","fullWidth","","placeholder","N\xe1zev jednotky","formControlName","unitName","nbTooltip","Tento n\xe1zev jednotky ji\u017e existuje","nbTooltipStatus","danger","nbTooltipIcon","alert-triangle","nbTooltipPlacement","right",3,"status","nbTooltipTrigger"],["fxLayout","row","fxLayoutAlign","space-between center"],["nbButton","","outline","","type","button",3,"click"],["icon","close"],["nbButton","","status","primary","type","submit","outline","",3,"disabled"],["icon","checkmark"]],template:function(i,t){1&i&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return t.onSubmit()}),e.TgZ(1,"nb-card",1)(2,"nb-card-header"),e._UZ(3,"nb-icon",2),e._uU(4," Editace jednotky "),e.qZA(),e.TgZ(5,"nb-card-body",3)(6,"nb-form-field"),e._UZ(7,"nb-icon",4)(8,"input",5),e.qZA()(),e.TgZ(9,"nb-card-footer",6)(10,"button",7),e.NdJ("click",function(){return t.dismiss()}),e._UZ(11,"nb-icon",8),e._uU(12,"Zru\u0161it "),e.qZA(),e.TgZ(13,"button",9),e._UZ(14,"nb-icon",10),e._uU(15,"Ulo\u017eit "),e.qZA()()()()),2&i&&(e.Q6J("formGroup",t.editUnitForm),e.xp6(8),e.Q6J("status",t.unitNameStatus)("nbTooltipTrigger",t.trigger),e.xp6(5),e.Q6J("disabled",!t.editUnitForm.valid||!t.editUnitForm.dirty))},directives:[d._Y,d.JL,d.sg,o.Asz,o.ndF,o.fMN,o.yKW,c.SQ,c.xw,o.jBG,o.t3q,o.h8i,d.Fj,d.JJ,d.u,o.jNv,o.XWE,c.Wh,o.DPz],styles:[""]}),s})();var f=a(7767),w=a(9748);function x(s,r){1&s&&(e.TgZ(0,"div"),e._uU(1," Jednotka obsahuje u\u017eivatele, nen\xed ji mo\u017en\xe9 smazat "),e.qZA())}function k(s,r){1&s&&(e.TgZ(0,"div"),e._uU(1," Opravdu chcete smazat jednotku? "),e.qZA())}let I=(()=>{class s{constructor(i,t,n){this.nbDialogRef=i,this.toastrService=t,this.unitsService=n,this.ableToDelete=!1,this.deleteCheckFinished=!1,this.unsubscribe=new h.x}ngOnInit(){this.unitsService.ableToDelete(this.unitId).pipe((0,m.R)(this.unsubscribe)).subscribe(i=>{this.ableToDelete=i,this.deleteCheckFinished=!0})}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}dismiss(){this.nbDialogRef.close()}deleteUnit(i){this.unitsService.deleteUnit(i).subscribe(()=>{this.toastrService.success("smaz\xe1na","Jednotka",{icon:"layers-outline"}),this.nbDialogRef.close()},t=>{this.toastrService.danger("nebyla smaz\xe1na","Jednotka",{icon:"layers-outline"})})}}return s.\u0275fac=function(i){return new(i||s)(e.Y36(o.X4l),e.Y36(o.quB),e.Y36(b.X))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-delete-unit-dialog"]],inputs:{unitId:"unitId"},decls:14,vars:4,consts:[["status","danger","size","tiny","nbSpinnerSize","large","nbSpinnerStatus","info","nbSpinnerMessage","Kontroluji zda je mo\u017en\xe9 jednotku smazat",2,"width","30em",3,"nbSpinner"],["icon","layers"],["fxLayout","column","fxLayoutGap","1em"],[4,"ngIf"],["fxLayout","row","fxLayoutAlign","end center","fxLayoutGap","1em"],["nbButton","","outline","","type","button",3,"click"],["icon","close"],["nbButton","","status","danger",3,"disabled","click"],["icon","trash-outline"]],template:function(i,t){1&i&&(e.TgZ(0,"nb-card",0)(1,"nb-card-header"),e._UZ(2,"nb-icon",1),e._uU(3," Smaz\xe1n\xed jednotky "),e.qZA(),e.TgZ(4,"nb-card-body",2),e.YNc(5,x,2,0,"div",3),e.YNc(6,k,2,0,"div",3),e.qZA(),e.TgZ(7,"nb-card-footer",4)(8,"button",5),e.NdJ("click",function(){return t.dismiss()}),e._UZ(9,"nb-icon",6),e._uU(10,"Zru\u0161it "),e.qZA(),e.TgZ(11,"button",7),e.NdJ("click",function(){return t.deleteUnit(t.unitId)}),e._UZ(12,"nb-icon",8),e._uU(13,"Smazat "),e.qZA()()()),2&i&&(e.Q6J("nbSpinner",!t.deleteCheckFinished),e.xp6(5),e.Q6J("ngIf",!t.ableToDelete),e.xp6(1),e.Q6J("ngIf",t.ableToDelete),e.xp6(5),e.Q6J("disabled",!t.ableToDelete))},directives:[o.Asz,o.Q7R,o.ndF,o.fMN,o.yKW,c.xw,c.SQ,U.O5,o.XWE,c.Wh,o.DPz],styles:[""]}),s})();var Z=a(3148),R=a(8505),j=a(4004),g=a(1777),z=a(1956);const E=[{path:"",component:(()=>{class s{constructor(i,t,n,l,u){this.unitsService=i,this.tokenService=t,this.nbWindowService=n,this.nbDialogService=l,this.agGridService=u,this.knownIds=[],this.animStart=!1,this.createUnitsAllowed=!1,this.editUnitsAllowed=!1,this.deleteUnitsAllowed=!1,this.unsubscribe=new h.x,this.units=[],this.columnDefs=[],this.autoGroupColumnDef={headerName:"Jednotky",cellRendererParams:{suppressCount:!0}},this.gridOptions={rowClassRules:{"ag-new-create":p=>p.data.newOne,"ag-row-delete":p=>p.data.delete},localeText:Z.g,treeData:!0,animateRows:!0,suppressRowClickSelection:!0,defaultColDef:{sortable:!0,floatingFilter:!0,filter:"agTextColumnFilter",enableRowGroup:!0},rowSelection:"multiple",sideBar:{toolPanels:[{id:"columns",labelDefault:"Sloupce",labelKey:"columns",iconKey:"columns",toolPanel:"agColumnsToolPanel"},{id:"filters",labelDefault:"Filtry",labelKey:"filters",iconKey:"filter",toolPanel:"agFiltersToolPanel"}],hiddenByDefault:!1},frameworkComponents:{selectUnitCellRendererComponent:D.T}},this.gridContext={nbWindowService:this.nbWindowService,nbDialogService:this.nbDialogService,permissions:{}},this.getDataPath=p=>p.tree}ngOnInit(){this.tokenService.getToken().pipe((0,m.R)(this.unsubscribe)).subscribe(i=>{this.unitsService.getUnits().pipe((0,R.b)(()=>{this.animStart=!0}),(0,j.U)(t=>null==t?void 0:t.map(n=>Object.assign(Object.assign({},n),{newOne:!this.knownIds.includes(n.id)})))).pipe((0,m.R)(this.unsubscribe)).subscribe(t=>{this.units=t,setTimeout(()=>{this.knownIds=t.map(n=>n.id),this.animStart=!1,this.units=t.map(n=>Object.assign(Object.assign({},n),{newOne:!1,delete:!0}))},2e3)}),this.createUnitsAllowed=this.tokenService.getPermission(f.ri.createUnits),this.editUnitsAllowed=this.tokenService.getPermission(f.ri.editUnits),this.deleteUnitsAllowed=this.tokenService.getPermission(f.ri.deleteUnits),this.gridContext.permissions={createUnitsAllowed:this.createUnitsAllowed,editUnitsAllowed:this.editUnitsAllowed,deleteUnitsAllowed:this.deleteUnitsAllowed}}),this.agGridService.isUnitsCollapsed().pipe((0,m.R)(this.unsubscribe)).subscribe(i=>{var t,n;i?null===(t=this.gridApi)||void 0===t||t.collapseAll():null===(n=this.gridApi)||void 0===n||n.expandAll()})}ngOnDestroy(){this.unsubscribe.next(!0)}onGridSizeChanged(){var i;null===(i=this.gridApi)||void 0===i||i.sizeColumnsToFit()}filterSet(){this.storedFilterModel=this.gridApi.getFilterModel()}onGridReady(i){this.gridApi=i.api}getContextMenuItems(i){const t=[],n=i.context.permissions;return n.editUnitsAllowed&&t.push({name:"Editace jednotky",action:()=>{var l,u;i.context.nbDialogService.open(A,{context:{unitId:null===(u=null===(l=i.node)||void 0===l?void 0:l.data)||void 0===u?void 0:u.id}})},icon:"&#9998;"}),n.createUnitsAllowed&&t.push({name:"Tvorba podjednotky",action:()=>{var l,u;i.context.nbDialogService.open(w.i,{hasBackdrop:!0,context:{parentId:null===(u=null===(l=i.node)||void 0===l?void 0:l.data)||void 0===u?void 0:u.id}})},icon:"&#43;"}),n.deleteUnitsAllowed&&t.push({name:"Smaz\xe1n\xed jednotky",action:()=>{var l,u;i.context.nbDialogService.open(I,{hasBackdrop:!0,context:{unitId:null===(u=null===(l=i.node)||void 0===l?void 0:l.data)||void 0===u?void 0:u.id}})},icon:"&#9866;"}),[...t,"copy","separator","csvExport","excelExport","separator","expandAll","contractAll"]}}return s.\u0275fac=function(i){return new(i||s)(e.Y36(b.X),e.Y36(y.B),e.Y36(o.eJ1),e.Y36(o.Gln),e.Y36(z.x))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-units-list"]],decls:2,vars:9,consts:[["fxFlex",""],[1,"ag-theme-alpine",2,"height","100%","width","100%",3,"columnDefs","gridOptions","rowData","getContextMenuItems","context","getDataPath","groupDefaultExpanded","autoGroupColumnDef","gridReady","gridSizeChanged","toolPanelVisibleChanged","gridColumnsChanged","rowDataChanged","filterModified"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0)(1,"ag-grid-angular",1),e.NdJ("gridReady",function(l){return t.onGridReady(l)})("gridSizeChanged",function(){return t.onGridSizeChanged()})("toolPanelVisibleChanged",function(){return t.onGridSizeChanged()})("gridColumnsChanged",function(){return t.onGridSizeChanged()})("rowDataChanged",function(){return t.onGridSizeChanged()})("filterModified",function(){return t.filterSet()}),e.qZA()()),2&i&&(e.Q6J("@ngRowAnim",t.animStart),e.xp6(1),e.Q6J("columnDefs",t.columnDefs)("gridOptions",t.gridOptions)("rowData",t.units)("getContextMenuItems",t.getContextMenuItems)("context",t.gridContext)("getDataPath",t.getDataPath)("groupDefaultExpanded",-1)("autoGroupColumnDef",t.autoGroupColumnDef))},directives:[c.yH,C.N8],styles:["[_nghost-%COMP%]{height:100%;width:100%;display:block}"],data:{animation:[(0,g.X$)("ngRowAnim",[(0,g.eR)("*<=>*",[(0,g.IO)("div.ag-new-create",[(0,g.oB)({opacity:0,marginLeft:"-100px"}),(0,g.jt)(1e3)],{optional:!0}),(0,g.IO)("div.ag-row-delete",[(0,g.jt)(1e3,(0,g.oB)({opacity:0,marginLeft:"-100px"}))],{optional:!0})])])]}}),s})()}];let N=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[[S.Bz.forChild(E)],S.Bz]}),s})(),F=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[[N,U.ez,o.zyh,o.KdK,o.V7y,o.IIj,c.ae,o.nKr,o.T2N,d.UX,o.jSo,o.rgH,o.spT,o.caZ,C.sF,o.uuI]]}),s})()}}]);